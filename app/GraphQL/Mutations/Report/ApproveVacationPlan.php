<?php
/**
 * Created by PhpStorm.
 * User: Dmitriy <dmitriy@riabov.info>
 * Date: 01.02.2020
 * Time: 19:16
 */

namespace App\GraphQL\Mutations\Report;

use App\Exceptions\GraphqlException;
use App\GraphQL\Mutations\UpdateMutation;
use App\Models\Report\VacationPlan;

class ApproveVacationPlan extends UpdateMutation
{
    protected $modelClass = VacationPlan::class;

    /**
     * @param \App\GraphQL\Mutations\MutationData $data
     * @return \App\GraphQL\Mutations\Mutation
     * @throws GraphqlException
     * @throws \App\Exceptions\ModelNotFoundException
     */
    protected function transformAttributes($data)
    {
        if ($this->getModel()->status !== VacationPlan::SENT) {
            throw new GraphqlException('Report is currently locked for moderation');
        }

        $data->reason = null;
        $data->status = VacationPlan::APPROVED;
        return parent::transformAttributes($data); // TODO: Change the autogenerated stub
    }
}
